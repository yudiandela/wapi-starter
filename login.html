<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - WAPI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          sans-serif;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
        position: relative;
        overflow: hidden;
      }

      /* Animated background elements */
      .bg-gradient {
        position: absolute;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: 0;
      }

      .bg-gradient::before,
      .bg-gradient::after {
        content: '';
        position: absolute;
        border-radius: 50%;
        filter: blur(80px);
        opacity: 0.4;
        animation: float 8s ease-in-out infinite;
      }

      .bg-gradient::before {
        width: 400px;
        height: 400px;
        background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        top: -100px;
        left: -100px;
      }

      .bg-gradient::after {
        width: 350px;
        height: 350px;
        background: linear-gradient(135deg, #06b6d4, #3b82f6);
        bottom: -100px;
        right: -100px;
        animation-delay: -4s;
      }

      @keyframes float {
        0%,
        100% {
          transform: translate(0, 0) scale(1);
        }
        50% {
          transform: translate(30px, -30px) scale(1.1);
        }
      }

      .login-container {
        position: relative;
        z-index: 10;
        width: 100%;
        max-width: 420px;
        padding: 20px;
      }

      .login-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 24px;
        padding: 48px 40px;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      }

      .logo {
        text-align: center;
        margin-bottom: 32px;
      }

      .logo-icon {
        width: 64px;
        height: 64px;
        background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        border-radius: 16px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 16px;
        box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3);
      }

      .logo-icon svg {
        width: 32px;
        height: 32px;
        color: white;
      }

      .logo h1 {
        color: #f8fafc;
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 8px;
      }

      .logo p {
        color: #94a3b8;
        font-size: 14px;
      }

      .form-group {
        margin-bottom: 24px;
      }

      .form-group label {
        display: block;
        color: #cbd5e1;
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 8px;
      }

      .input-wrapper {
        position: relative;
      }

      .input-wrapper svg {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        width: 20px;
        height: 20px;
        color: #64748b;
        transition: color 0.2s;
      }

      .form-group input {
        width: 100%;
        padding: 14px 16px 14px 48px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        color: #f8fafc;
        font-size: 15px;
        font-family: inherit;
        transition: all 0.2s;
      }

      .form-group input::placeholder {
        color: #64748b;
      }

      .form-group input:focus {
        outline: none;
        border-color: #3b82f6;
        background: rgba(59, 130, 246, 0.05);
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
      }

      .form-group input:focus + svg,
      .input-wrapper:focus-within svg {
        color: #3b82f6;
      }

      .error-message {
        display: none;
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: #fca5a5;
        padding: 12px 16px;
        border-radius: 12px;
        font-size: 14px;
        margin-bottom: 24px;
        animation: shake 0.5s ease-in-out;
      }

      .error-message.show {
        display: block;
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-5px);
        }
        75% {
          transform: translateX(5px);
        }
      }

      .login-btn {
        width: 100%;
        padding: 14px 24px;
        background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        border: none;
        border-radius: 12px;
        color: white;
        font-size: 16px;
        font-weight: 600;
        font-family: inherit;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
        overflow: hidden;
      }

      .login-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
      }

      .login-btn:active {
        transform: translateY(0);
      }

      .login-btn:disabled {
        opacity: 0.7;
        cursor: not-allowed;
        transform: none;
      }

      .login-btn .spinner {
        display: none;
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin-right: 8px;
      }

      .login-btn.loading .spinner {
        display: inline-block;
      }

      .login-btn.loading .btn-text {
        opacity: 0.8;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .footer {
        text-align: center;
        margin-top: 24px;
        color: #64748b;
        font-size: 13px;
      }

      .footer a {
        color: #3b82f6;
        text-decoration: none;
        font-weight: 500;
      }

      .footer a:hover {
        text-decoration: underline;
      }

      /* Password toggle */
      .password-toggle {
        position: absolute;
        right: 16px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
        padding: 4px;
        color: #64748b;
        transition: color 0.2s;
      }

      .password-toggle:hover {
        color: #94a3b8;
      }

      .password-toggle svg {
        position: static;
        transform: none;
        width: 20px;
        height: 20px;
      }
    </style>
  </head>
  <body>
    <div class="bg-gradient"></div>

    <div class="login-container">
      <div class="login-card">
        <div class="logo">
          <div class="logo-icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
              />
            </svg>
          </div>
          <h1>WAPI</h1>
          <p>WhatsApp API Dashboard</p>
        </div>

        <div class="error-message" id="errorMessage"></div>

        <form id="loginForm">
          <div class="form-group">
            <label for="username">Username</label>
            <div class="input-wrapper">
              <input
                type="text"
                id="username"
                name="username"
                placeholder="Enter your username"
                required
                autocomplete="username"
              />
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                />
              </svg>
            </div>
          </div>

          <div class="form-group">
            <label for="password">Password</label>
            <div class="input-wrapper">
              <input
                type="password"
                id="password"
                name="password"
                placeholder="Enter your password"
                required
                autocomplete="current-password"
              />
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
                />
              </svg>
              <button type="button" class="password-toggle" id="togglePassword">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="2"
                  id="eyeIcon"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                  />
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                  />
                </svg>
              </button>
            </div>
          </div>

          <button type="submit" class="login-btn" id="loginBtn">
            <span class="spinner"></span>
            <span class="btn-text">Sign In</span>
          </button>
        </form>

        <div class="footer">
          <p>Powered by <a href="https://github.com/azickri" target="_blank">WAPI Starter</a></p>
        </div>
      </div>
    </div>

    <script>
      // Check if already logged in
      const token = localStorage.getItem('wapi_token');
      if (token) {
        window.location.href = '/';
      }

      const form = document.getElementById('loginForm');
      const errorMessage = document.getElementById('errorMessage');
      const loginBtn = document.getElementById('loginBtn');
      const passwordInput = document.getElementById('password');
      const togglePassword = document.getElementById('togglePassword');

      // Toggle password visibility
      togglePassword.addEventListener('click', () => {
        const type = passwordInput.type === 'password' ? 'text' : 'password';
        passwordInput.type = type;

        // Update icon
        const eyeIcon = document.getElementById('eyeIcon');
        if (type === 'text') {
          eyeIcon.innerHTML = `
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" />
          `;
        } else {
          eyeIcon.innerHTML = `
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
          `;
        }
      });

      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        // Hide previous error
        errorMessage.classList.remove('show');

        // Show loading state
        loginBtn.classList.add('loading');
        loginBtn.disabled = true;

        try {
          const response = await fetch('/auth/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ username, password }),
          });

          const data = await response.json();

          if (data.success) {
            // Store auth data
            localStorage.setItem('wapi_token', data.data.token);
            localStorage.setItem('wapi_api_key', data.data.api_key);
            localStorage.setItem('wapi_user', JSON.stringify(data.data.user));

            // Redirect to dashboard
            window.location.href = '/';
          } else {
            errorMessage.textContent = data.message || 'Login failed';
            errorMessage.classList.add('show');
          }
        } catch (error) {
          console.error('Login error:', error);
          errorMessage.textContent = 'Connection error. Please try again.';
          errorMessage.classList.add('show');
        } finally {
          loginBtn.classList.remove('loading');
          loginBtn.disabled = false;
        }
      });
    </script>
  </body>
</html>
